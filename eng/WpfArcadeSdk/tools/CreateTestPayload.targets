<Project>
    <!-- We use a local RID here since we don't want to change the build layout by setting the actual RID. -->
  <PropertyGroup>
    <NoWarn>$(NoWarn);NU3027;NU3018</NoWarn>

     <!-- Arcade SDK defaults to AnyCpu ~= x64. In WPF, we will map AnyCpu => x86 instead -->
    <PlatformFolder>x86</PlatformFolder>
    <PlatformFolder Condition="'$(Platform)' == 'x64'">x64</PlatformFolder>
    <PayloadRoot>$(RepoRoot)artifacts\test\$(Configuration)\$(PlatformFolder)</PayloadRoot>

    <WpfTestBasePayloadPath>$(PayloadRoot)\Test\</WpfTestBasePayloadPath>

    <WindowsDesktopPayloadPath>$(PayloadRoot)\dotnet\shared\Microsoft.WindowsDesktop.App\</WindowsDesktopPayloadPath>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="runtime.$(WpfRuntimeIdentifier).Microsoft.DotNet.Wpf.Test" Version="$(MicrosoftDotNetWpfTestPackageVersion)" GeneratePathProperty="true" />
  </ItemGroup>

  <PropertyGroup Condition="'$(WpfRuntimeIdentifier)'=='win-x86'">
    <MicrosoftDotNetWpfTestPath>$(Pkgruntime_win-x86_Microsoft_DotNet_Wpf_Test)\tools\$(WpfRuntimeIdentifier)\Test\</MicrosoftDotNetWpfTestPath>
  </PropertyGroup>

  <PropertyGroup Condition="'$(WpfRuntimeIdentifier)'=='win-x64'">
    <MicrosoftDotNetWpfTestPath>$(Pkgruntime_win-x64_Microsoft_DotNet_Wpf_Test)\tools\$(WpfRuntimeIdentifier)\Test\</MicrosoftDotNetWpfTestPath>
  </PropertyGroup>

  <Target Name="CreateTestPayload" BeforeTargets="Test" AfterTargets="Build">
    <ItemGroup>
      <MicrosoftDotNetWpfTestContents Include="$(MicrosoftDotNetWpfTestPath)**\*.*" />
      <OtherPayloadContents Include="$(WpfArcadeSdkToolsDir)runtests.cmd" />
      <OtherPayloadContents Include="$(WpfArcadeSdkToolsDir)runtests.ps1" />
      <OtherPayloadContents Include="$(WpfArcadeSdkToolsDir)configure-helix-machine.ps1" Condition="'$(ContinuousIntegrationBuild)'=='True'" />

      <!-- 
        We have to ship over the WindowsDesktop for our test infrastructure.
        Once https://github.com/dotnet/wpf/issues/816 is done we can remove this.
      -->
      <WindowsDesktopContents Include="$(RepoRoot).dotnet\shared\Microsoft.WindowsDesktop.App\**\*.*" />
    </ItemGroup>

    <Copy SourceFiles="@(MicrosoftDotNetWpfTestContents)"
          DestinationFiles="@(MicrosoftDotNetWpfTestContents->'$(WpfTestBasePayloadPath)%(RecursiveDir)%(Filename)%(Extension)')"  />

    <Copy SourceFiles="@(OtherPayloadContents)"
          DestinationFolder="$(PayloadRoot)"  />

    <Copy SourceFiles="$(WpfTestsDir)BranchCommon\data\DrtList.xml"
          DestinationFolder="$(WpfTestBasePayloadPath)DRT"  />

    <Copy SourceFiles="@(WindowsDesktopContents)"
          DestinationFiles="@(WindowsDesktopContents->'$(WindowsDesktopPayloadPath)%(RecursiveDir)%(Filename)%(Extension)')"
          Condition="'$(ContinuousIntegrationBuild)'=='True'"/>
  </Target>

</Project>
